workflow: pipeline_bootstrap
title: "Pipeline Bootstrap"
description: "Create a pipeline and couple apps to development, staging, and production stages."
inputs:
  pipeline_name:
    name: "Pipeline Name"
    description: "Name for pipeline"
    type: string
  team:
    name: "Team"
    provider: teams list
    select: { value_field: id, display_field: name }
  dev_app:
    name: "Dev App"
    provider: apps list
    select: { value_field: name, display_field: name }
  staging_app:
    name: "Staging App"
    provider: apps list
    select: { value_field: name, display_field: name }
  prod_app:
    name: "Prod App"
    provider: apps list
    select: { value_field: name, display_field: name }
steps:
  - id: create_pipeline
    run: pipelines create
    body:
      name: ${{ inputs.pipeline_name }}
      owner:
        id: ${{ inputs.team }}

  - id: couple_dev
    run: pipeline-couplings create
    body:
      app: ${{ inputs.dev_app }}
      pipeline: ${{ steps.create_pipeline.output.id }}
      stage: development

  - id: couple_staging
    run: pipeline-couplings create
    body:
      app: ${{ inputs.staging_app }}
      pipeline: ${{ steps.create_pipeline.output.id }}
      stage: staging

  - id: couple_prod
    run: pipeline-couplings create
    body:
      app: ${{ inputs.prod_app }}
      pipeline: ${{ steps.create_pipeline.output.id }}
      stage: production

