workflow: incident_rollback_and_scale
title: "Rollback app and Scale"
description: "Quickly roll back an app to a prior release and scale dynos, then tail logs."
inputs:
  app:
    provider: apps list
    select: { value_field: name, display_field: name }
  release:
    description: "Target release version to roll back to (e.g., v123)"
    provider: apps releases list
    select: { value_field: version, display_field: version }
    depends_on:
      app: ${{ inputs.app }}
  formation:
    description: "Dyno formation to scale"
    type: string
    default:
      from: literal
      value: "web"
  quantity:
    description: "Number of dynos to scale to"
    type: number
    default:
      from: literal
      value: 1
steps:
  - id: rollback
    run: apps releases:rollback
    with:
      app: ${{ inputs.app }}
    body:
      release: ${{ inputs.release }}

  - id: scale
    run: apps ps:scale
    with:
      app: ${{ inputs.app }}
    body:
      formation: ${{ inputs.formation }}
      quantity: ${{ inputs.quantity }}

  - id: tail_logs
    description: "Tail logs to verify app health after rollback"
    run: apps logs
    with:
      app: ${{ inputs.app }}
    body:
      tail: true
