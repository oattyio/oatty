workflow: postgres_credentials_rotate
title: "Postgres credentials rotate"
description: "Rotate credentials (default or a named credential) for a selected Postgres database on an app."
inputs:
  app:
    name: "App"
    provider: apps list
    select: { value_field: name, display_field: name }
  database:
    name: "Database"
    description: "Database attachment name to rotate credentials for"
    provider: apps addons:list
    depends_on:
      app: ${{ inputs.app }}
    select: { value_field: name, display_field: name }
  credential:
    name: "Credential"
    description: "Specific credential name to rotate (optional). Leave blank to rotate default."
    type: string
    optional: true
steps:
  - id: rotate_named
    when: ${{ !!inputs.credential }}
    run: apps pg:credentials:rotate
    with:
      app: ${{ inputs.app }}
    body:
      database: ${{ inputs.database }}
      credentials: ${{ inputs.credential }}

  - id: rotate_default
    when: ${{ !inputs.credential }}
    run: apps pg:credentials:rotate
    with:
      app: ${{ inputs.app }}
    body:
      database: ${{ inputs.database }}
