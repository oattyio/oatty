workflow: postgres_cluster_health_snapshot
title: "Postgres cluster health snapshot"
description: "Gather a consistent health snapshot for a Performance-tier Heroku Postgres cluster: topology, pools, settings, and quotas."
inputs:
  app:
    provider: apps list
    select: { value_field: name, display_field: name }
  addon:
    description: "Heroku Postgres addon name or ID (Performance tier)."
    provider: apps addons:list
    depends_on:
      app: ${{ inputs.app }}
    select: { value_field: name, display_field: name }
steps:
  - id: cluster_overview
    description: "Fetch cluster topology (pools, instances, quotas) via the Next-Gen info endpoint."
    run: data postgres:info:list
    with:
      addon: ${{ inputs.addon }}

  - id: settings_dump
    description: "Capture current database settings for auditing and diffing."
    run: data postgres:settings:list
    with:
      addon: ${{ inputs.addon }}

  - id: quota_status
    description: "Record present storage usage and enforcement configuration."
    run: data postgres:quotas:storage:list
    with:
      addon: ${{ inputs.addon }}
