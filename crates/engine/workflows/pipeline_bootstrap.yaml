workflow: pipeline_bootstrap
inputs:
  pipeline_name:
    description: "Name for pipeline"
    type: string
  team:
    provider: teams:list
    select: { value_field: id, display_field: name }
  dev_app:
    provider: apps:list
    select: { value_field: name, display_field: name }
  staging_app:
    provider: apps:list
    select: { value_field: name, display_field: name }
  prod_app:
    provider: apps:list
    select: { value_field: name, display_field: name }
steps:
  - id: create_pipeline
    run: pipelines:create
    body:
      name: ${{ inputs.pipeline_name }}
      owner: { id: ${{ inputs.team }} }

  - id: couple_dev
    run: pipeline-couplings:create
    body:
      app: ${{ inputs.dev_app }}
      pipeline: ${{ steps.create_pipeline.output.id }}
      stage: development

  - id: couple_staging
    run: pipeline-couplings:create
    body:
      app: ${{ inputs.staging_app }}
      pipeline: ${{ steps.create_pipeline.output.id }}
      stage: staging

  - id: couple_prod
    run: pipeline-couplings:create
    body:
      app: ${{ inputs.prod_app }}
      pipeline: ${{ steps.create_pipeline.output.id }}
      stage: production

