workflow: build_from_tarball
inputs:
  app:
    provider: apps:list
    select: { value_field: name, display_field: name, id_field: id }
  tar_path:
    description: "Path to tarball"
    type: file
steps:
  - id: create_sources
    run: sources:create

  - id: upload
    run: shell:curl_put
    with:
      url: ${{ steps.create_sources.output.source_blob.put_url }}
      file: ${{ inputs.tar_path }}

  - id: build
    run: apps:builds:create
    with:
      app: ${{ inputs.app }}
    body:
      source_blob:
        url: ${{ steps.create_sources.output.source_blob.get_url }}

  - id: wait_for_build
    run: apps:builds:info
    with:
      app: ${{ inputs.app }}
      build: ${{ steps.build.output.id }}
    repeat:
      until: ${{ ["succeeded","failed"].includes(step.output.status) }}
      every: 10s

